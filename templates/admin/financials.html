{% extends "base.html" %}

{% block title %}Financial Reports{% endblock %}

{% block content %}
<div class="card">
    <h2>Bank Financial Summary</h2>
    
    <div class="grid">
        <div class="stat-card">
            <h3>${{ "%.2f"|format(financial_summary.retained_earnings) }}</h3>
            <p>Retained Earnings</p>
        </div>
        <div class="stat-card">
            <h3>${{ "%.2f"|format(financial_summary.total_deposits) }}</h3>
            <p>Total Deposits</p>
        </div>
        <div class="stat-card">
            <h3>${{ "%.2f"|format(financial_summary.total_loans) }}</h3>
            <p>Total Loans</p>
        </div>
        <div class="stat-card">
            <h3>{{ financial_summary.total_accounts }}</h3>
            <p>Total Accounts</p>
        </div>
    </div>
    
    <div class="card" style="margin-top: 30px;">
        <h2>Update Retained Earnings</h2>
        <form method="POST" action="{{ url_for('admin.update_earnings') }}">
            <div class="form-group">
                <label for="net_income">Net Income:</label>
                <input type="number" name="net_income" id="net_income" step="0.01" required>
            </div>
            <div class="form-group">
                <label for="dividends">Dividends:</label>
                <input type="number" name="dividends" id="dividends" step="0.01" required>
            </div>
            <button type="submit" class="btn btn-success">Update Earnings</button>
        </form>
    </div>
    
    <div class="card" style="margin-top: 30px;">
        <h2>Audit Log (Last 50 entries)</h2>
        {% if audit_log %}
            <table>
                <thead>
                    <tr>
                        <th>Transaction ID</th>
                        <th>Type</th>
                        <th>Amount</th>
                        <th>Status</th>
                        <th>Approved By</th>
                        <th>Time</th>
                    </tr>
                </thead>
                <tbody>
                    {% for entry in audit_log %}
                    <tr>
                        <td>{{ entry.transaction_id }}</td>
                        <td>{{ entry.transaction_type.title() }}</td>
                        <td>${{ "%.2f"|format(entry.amount) }}</td>
                        <td>{{ entry.status.title() }}</td>
                        <td>{{ entry.approved_by or 'N/A' }}</td>
                        <td>{{ entry.created_at[:19] if entry.created_at else 'N/A' }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>No audit log entries yet.</p>
        {% endif %}
    </div>
    
    <a href="{{ url_for('admin.dashboard') }}" class="btn" style="margin-top: 20px;">Back to Dashboard</a>
</div>
{% endblock %}

